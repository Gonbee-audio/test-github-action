# This is a basic workflow to help you get started with Actions

name: CIHOGE

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the main branch
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    inputs:
      subdir:
        required: true
    outputs:
      diff-count:
        value: ${{ steps.diff.outputs.diff-count }}
    runs:
      using: composite
      steps:
        - id: diff
          env:
            TARGET_BRANCH: ${{ github.base_ref }}
          run: |
            git fetch origin ${TARGET_BRANCH}
            count=`git diff origin/${TARGET_BRANCH} HEAD --name-only --relative=${{ inputs.subdir }} | wc -l`
            echo "::set-output name=diff-count::$(echo $count)"
          shell: bash

